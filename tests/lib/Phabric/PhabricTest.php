<?php

namespace Phabric;
use Mockery as m;


/**
 * Test class for Bus.
 * Generated by PHPUnit on 2011-07-31 at 12:12:00.
 */
class BusTest extends \PHPUnit_Framework_TestCase
{

    /**
     * @var Bus
     */
    protected $object;

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp()
    {
        $db  = m::mock('\Doctrine\DBAL\Connection');
        $this->object = new Phabric($db);
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {
        \Mockery::close();
    }
    
    public function testCreateEntity()
    {
        $entity = $this->object->createEntity('Event');
        
        $this->assertType('\Phabric\Entity', $entity);
    }
    
    public function testCreateEntityWithConfig()
    {
        $entity = $this->object->createEntity('Event', array('tableName' => 'event'));
        
        $this->assertType('\Phabric\Entity', $entity);
    }
    
    public function testCreateEntityHasRegisteredEntity()
    {
        $this->object->createEntity('Event');
            
        $entity = $this->object->getEntity('Event');
        
        $this->assertType('\Phabric\Entity', $entity);
    }

    /**
     * @todo Implement testRegisterNamedDataTranslation().
     */
    public function testRegisterNamedDataTranslation()
    {
        $fn = function($a, $b) { $c = $a + $b; return $c; };

        $this->object->registerNamedDataTranslation('test', $fn);

        $this->assertEquals($fn, $this->object->getNamedDataTranslation('test'));
    }

    /**
     * @expectedException InvalidArgumentException
     */
    public function testRegisterNamedDataTranslationNonCallableArgument()
    {
        $fn = array();

        $this->object->registerNamedDataTranslation('test', $fn);
    }

    /**
     * @expectedException InvalidArgumentException
     */
    public function testGetNamedDataTranslationNotFound()
    {
        $this->object->getNamedDataTranslation('test');
    }

    /**
     * @expectedException InvalidArgumentException
     */
    public function testGetEntityNotFound()
    {
        $this->object->getEntity('anything');
    }

}

